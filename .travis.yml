dist: xenial
language: python
stages:
  - "Static code analysis"
  - test
  - deploy
python:
  - "3.5"
  - "3.6"
  - "3.7"
notifications:
  email: false
install:
  - pip install --upgrade pip
  - pip install '.[test,doc,dev]'
script:
  # run tests, and get coverage:
  - poetry run python -m pytest --cov=src/
  # test that the notebooks all run smoothly
  - find docs -name '*.ipynb' -o -name 'examples/*.ipynb' | xargs poetry run jupyter nbconvert --to notebook --execute
  # submit coverage report to coveralls
  - poetry run coveralls
jobs:
  include:
    - stage: "Static code analysis"
      name: "black formatting test"
      script:
        - pip install -qq black
        - black --check superintendent/
      python: "3.7"
      install: skip
    - stage: "Static code analysis"
      name: "flake8 check"
      script:
        - pip install -qq flake8 docargs
        - flake8 src/
      python: "3.7"
      install: skip
    # - stage: deploy
    #   name: "Deploy to pypi"
    #   if: tag IS present
    #   script:
    #     - poetry build
    #     - poetry publish --username $PYPI_USER --password $PYPI_PASSWORD
    #   python: "3.7"
